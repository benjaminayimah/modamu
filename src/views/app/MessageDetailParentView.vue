<template>
<div class="u-profile relative">
    <button @click="$emit('close')" class="br-50 close-btn">
        <svg xmlns="http://www.w3.org/2000/svg" height="14.683" viewBox="0 0 14.647 14.683">
            <path d="M5648.416,3695.679l-5.629-5.655-5.6,5.59a1,1,0,1,1-1.412-1.415l5.6-5.592-5.584-5.61a1,1,0,1,1,1.418-1.411l5.583,5.608,5.623-5.61a1,1,0,1,1,1.412,1.417l-5.624,5.611,5.631,5.657a1,1,0,1,1-1.418,1.411Z" transform="translate(-5635.478 -3681.291)" fill="#6f7689"/>
        </svg>
    </button>
    <div class="profile-body flx gap-16 column">
        <div class="flx ai-c column gap-16">
            <profile-avatar :image="user.image"  :id="user.id"/>
            <h4 class="capitalize">{{ $route.params.name }}</h4>
            <span class="acc-type br-32">{{ computedAcct }}</span>
        </div>
        <div class="flx column gap-16">
            <h4 class="gray text-center">Account information</h4>
            <div class="flx jc-sb br-16 info-row ai-c">
                <div class="flx gap-8">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 17.455 16">
                        <path d="M4.332,15.676A5.36,5.36,0,0,1,1.669,14.47C.468,13.37,0,11.556,0,8A13.03,13.03,0,0,1,.7,2.909,4.612,4.612,0,0,1,.936,2.45l.013-.022A4,4,0,0,1,3.083.679l0,0L3.132.661,3.153.652l.03-.011L3.21.631,3.236.622l.029-.01L3.319.593A17.369,17.369,0,0,1,8.727,0a22.583,22.583,0,0,1,4.4.324,5.368,5.368,0,0,1,2.663,1.205c1.2,1.1,1.669,2.915,1.669,6.471s-.468,5.369-1.669,6.47a5.36,5.36,0,0,1-2.663,1.206,22.583,22.583,0,0,1-4.4.324A22.583,22.583,0,0,1,4.332,15.676ZM1.454,8c0,3.055.347,4.619,1.2,5.4a4.075,4.075,0,0,0,1.971.853,21.326,21.326,0,0,0,4.1.294,21.326,21.326,0,0,0,4.1-.294A4.079,4.079,0,0,0,14.8,13.4c.851-.779,1.2-2.344,1.2-5.4a15.014,15.014,0,0,0-.373-3.921c-.4.4-.922.886-1.512,1.374A14.777,14.777,0,0,1,11.54,7.2,6.261,6.261,0,0,1,8.727,8H8.722a6.262,6.262,0,0,1-2.814-.794,14.784,14.784,0,0,1-2.584-1.75c-.585-.483-1.1-.966-1.5-1.361A15.027,15.027,0,0,0,1.454,8ZM3.79,1.969a2.982,2.982,0,0,0-1.27.765,22.111,22.111,0,0,0,1.73,1.6,13.338,13.338,0,0,0,2.324,1.58,4.87,4.87,0,0,0,2.148.632,4.856,4.856,0,0,0,2.149-.635,13.233,13.233,0,0,0,2.318-1.579,21.932,21.932,0,0,0,1.736-1.61l-.062-.064h0l-.016-.016,0,0-.015-.014,0,0L14.8,2.6a4.075,4.075,0,0,0-1.971-.853,21.326,21.326,0,0,0-4.1-.294A16.18,16.18,0,0,0,3.79,1.969Z" fill="#212135"/>
                    </svg>
                    <label>Email</label>
                </div>
                <span>{{ user.email }}</span>
            </div>
            <div class="flx jc-sb br-16 info-row ai-c">
                <div class="flx gap-8">
                    <svg xmlns="http://www.w3.org/2000/svg" width="17" height="19" viewBox="0 0 19 19">
                        <path d="M14.562,19a5.619,5.619,0,0,1-2.279-.554A20.584,20.584,0,0,1,6.944,14.8c-.613-.549-1.853-1.76-2.252-2.217A22.3,22.3,0,0,1,.566,6.694,5.392,5.392,0,0,1,0,4.423,3.337,3.337,0,0,1,.61,2.46,7.015,7.015,0,0,1,1.834,1.12,3.82,3.82,0,0,1,4.366,0l.058,0A2.513,2.513,0,0,1,5.9.753c.305.3,2.107,2.323,2.3,3.216A2.706,2.706,0,0,1,7.75,5.955l-.018.032c-.064.111-.142.229-.225.354a4.21,4.21,0,0,0-.412.719A9.394,9.394,0,0,0,8.332,9.146a14.234,14.234,0,0,0,2.049,1.987,8.462,8.462,0,0,0,1.508.855,4.088,4.088,0,0,0,.761-.425c.115-.075.223-.146.325-.206l.039-.022a3.067,3.067,0,0,1,1.532-.5,2.268,2.268,0,0,1,.466.049,11.923,11.923,0,0,1,3.222,2.246A2.388,2.388,0,0,1,19,14.648l0,.028c.073,1.749-1.964,3.392-2.457,3.708A3.326,3.326,0,0,1,14.562,19ZM4.283,1.584c-.816.008-2.075,1.3-2.327,1.708l-.021.036-.022.03a1.76,1.76,0,0,0-.331,1.065,3.857,3.857,0,0,0,.422,1.612l.014.031a21.031,21.031,0,0,0,3.844,5.457l.016.018C6.2,11.9,7.385,13.074,8,13.625a18.64,18.64,0,0,0,4.892,3.36l.029.012a4.087,4.087,0,0,0,1.641.419,1.75,1.75,0,0,0,1.069-.329l.028-.02.029-.018c.44-.266,1.744-1.5,1.728-2.293a.952.952,0,0,0-.3-.5l-.005-.005a13.458,13.458,0,0,0-2.436-1.815.67.67,0,0,0-.128-.013,1.691,1.691,0,0,0-.757.293l-.021.012c-.067.039-.16.1-.251.16a3.279,3.279,0,0,1-1.662.692,1.3,1.3,0,0,1-.443-.076l-.033-.013a9.964,9.964,0,0,1-1.908-1.063A15.6,15.6,0,0,1,7.108,10.15l-.018-.023a10.917,10.917,0,0,1-1.5-2.568L5.58,7.538C5.3,6.8,5.814,6.03,6.186,5.468c.069-.1.134-.2.174-.272l.014-.025c.207-.364.332-.6.281-.859A13.423,13.423,0,0,0,4.8,1.89,1.045,1.045,0,0,0,4.283,1.584Z" transform="translate(0 0)" fill="#212135"/>
                    </svg>
                    <label>Phone number</label>
                </div>
                <span>{{ user.phone || 'n/a' }}</span>
            </div>
            <div v-if="user.emergency_number" class="flx jc-sb br-16 info-row ai-c">
                <div class="flx gap-8">
                    <svg xmlns="http://www.w3.org/2000/svg" width="17" height="19" viewBox="0 0 19.001 19">
                        <path d="M-3404.717-700.554a20.176,20.176,0,0,1-5.339-3.641c-.635-.568-1.853-1.762-2.246-2.21l0,0-.008-.009,0,0v0a22.592,22.592,0,0,1-4.123-5.89,5.4,5.4,0,0,1-.566-2.272,3.345,3.345,0,0,1,.609-1.961,4.583,4.583,0,0,1,.439-.566,8.23,8.23,0,0,1,.81-.8,3.932,3.932,0,0,1,2.508-1.1h.029l.029,0a2.539,2.539,0,0,1,1.479.748l0,0a16.284,16.284,0,0,1,1.261,1.478c.229.3.451.6.627.881.088.138.171.276.238.408a1.88,1.88,0,0,1,.169.448,2.662,2.662,0,0,1-.427,1.94l-.025.044-.018.031c-.064.112-.146.235-.218.343l-.007.012a5.121,5.121,0,0,0-.363.6,1.062,1.062,0,0,0-.048.118,9.434,9.434,0,0,0,1.236,2.083,14.171,14.171,0,0,0,2.048,1.987,8.443,8.443,0,0,0,1.507.854,1.085,1.085,0,0,0,.141-.056,5.25,5.25,0,0,0,.621-.369l.011-.006c.1-.066.213-.14.315-.2l.005,0,.033-.018.041-.024a2.719,2.719,0,0,1,1.955-.423,1.868,1.868,0,0,1,.444.165c.131.065.269.145.407.23.276.173.585.39.884.613a15.653,15.653,0,0,1,1.489,1.238l0,0,0,.005,0,0a2.406,2.406,0,0,1,.763,1.514l0,.014v.014a3.768,3.768,0,0,1-1.068,2.452,7.2,7.2,0,0,1-1.391,1.257,3.311,3.311,0,0,1-1.969.614A5.64,5.64,0,0,1-3404.717-700.554Zm-10.344-15.123-.024.034a1.764,1.764,0,0,0-.33,1.065,3.854,3.854,0,0,0,.422,1.612l.007.015.006.015a21.057,21.057,0,0,0,3.844,5.458l.008.009.008.009c.314.362,1.5,1.528,2.12,2.084a18.693,18.693,0,0,0,4.892,3.361l.015.005.014.006c1.3.588,2.148.5,2.71.091l.028-.02.029-.018a5.715,5.715,0,0,0,1.04-.954,2.344,2.344,0,0,0,.688-1.339.877.877,0,0,0-.3-.5l0-.005a14.522,14.522,0,0,0-1.312-1.085c-.28-.209-.551-.4-.775-.538-.114-.07-.206-.122-.276-.158-.043-.022-.068-.031-.075-.034-.251-.049-.457.041-.884.281l-.022.012c-.061.036-.139.087-.25.16l-.018.012a6.568,6.568,0,0,1-.806.469,1.7,1.7,0,0,1-1.282.135l-.017-.005-.016-.007a9.89,9.89,0,0,1-1.908-1.064,15.481,15.481,0,0,1-2.362-2.277l-.009-.011-.009-.012a10.984,10.984,0,0,1-1.5-2.568l0-.011,0-.011a1.654,1.654,0,0,1,.13-1.264,6.4,6.4,0,0,1,.464-.788l.013-.019c.081-.122.136-.206.174-.272l.014-.024c.245-.429.328-.625.281-.858,0-.007-.012-.031-.033-.072-.036-.069-.089-.161-.16-.274-.143-.224-.338-.493-.55-.77a15.425,15.425,0,0,0-1.109-1.307,1.019,1.019,0,0,0-.52-.307,2.565,2.565,0,0,0-1.4.721,6.666,6.666,0,0,0-.65.64c-.085.1-.154.18-.2.246s-.065.088-.07.1,0,0,0,0Zm9.908,8.673h0Zm-11.262-9.495.044-.069-.02.029C-3416.4-716.525-3416.408-716.511-3416.415-716.5Zm4.107,10.085.006.007Zm0,0,0,0Zm12.728-3.876a7.123,7.123,0,0,0-1.945-5.18,7.123,7.123,0,0,0-5.179-1.946.791.791,0,0,1-.792-.791.792.792,0,0,1,.792-.792,8.668,8.668,0,0,1,6.3,2.409,8.668,8.668,0,0,1,2.409,6.3.792.792,0,0,1-.792.792A.792.792,0,0,1-3399.583-710.292Zm-3.166,0a3.787,3.787,0,0,0-3.958-3.958.792.792,0,0,1-.792-.792.791.791,0,0,1,.792-.791,5.36,5.36,0,0,1,5.541,5.541.792.792,0,0,1-.792.792A.792.792,0,0,1-3402.75-710.292Z" transform="translate(3417 719)" fill="#212135"/>
                    </svg>
                    <label>Emergency number</label>
                </div>
                <span>{{ user.emergency_number }}</span>
            </div>
            <div v-if="user.ocupation" class="flx jc-sb br-16 info-row ai-c">
                <div class="flx gap-8">
                    <svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 19.616 19.782">
                        <path d="M-3493.031-840.589a7.867,7.867,0,0,1-2.582-.621,2.521,2.521,0,0,1-1.275-1.257,4.984,4.984,0,0,1-.343-2.076,4.98,4.98,0,0,1,.343-2.075,2.52,2.52,0,0,1,1.275-1.257,7.887,7.887,0,0,1,2.582-.622,41.066,41.066,0,0,1,4.261-.167,41.066,41.066,0,0,1,4.261.167,7.886,7.886,0,0,1,2.582.622,2.524,2.524,0,0,1,1.275,1.257,4.981,4.981,0,0,1,.343,2.075,4.986,4.986,0,0,1-.343,2.076,2.524,2.524,0,0,1-1.275,1.257,7.87,7.87,0,0,1-2.582.621,40.774,40.774,0,0,1-4.261.167A40.771,40.771,0,0,1-3493.031-840.589Zm.165-6.379a6.7,6.7,0,0,0-2.073.475,1,1,0,0,0-.549.513,3.673,3.673,0,0,0-.2,1.436,3.675,3.675,0,0,0,.2,1.437,1,1,0,0,0,.549.513,6.7,6.7,0,0,0,2.073.475,39.511,39.511,0,0,0,4.1.158,39.481,39.481,0,0,0,4.1-.158,6.7,6.7,0,0,0,2.074-.475,1,1,0,0,0,.549-.513,3.67,3.67,0,0,0,.2-1.437,3.667,3.667,0,0,0-.2-1.436,1,1,0,0,0-.549-.513,6.7,6.7,0,0,0-2.074-.475,39.5,39.5,0,0,0-4.1-.157A39.51,39.51,0,0,0-3492.866-846.968Zm10.842-2.82-1.154-1.236a.769.769,0,0,1,.037-1.087.769.769,0,0,1,1.088.037l.591.634,2.515-2.694a.769.769,0,0,1,1.087-.038.769.769,0,0,1,.037,1.087l-3.076,3.3a.769.769,0,0,1-.562.245A.767.767,0,0,1-3482.024-849.788Zm-11.361-5.47a4.8,4.8,0,0,1,4.615-4.945,4.8,4.8,0,0,1,4.615,4.945,4.794,4.794,0,0,1-4.615,4.945A4.794,4.794,0,0,1-3493.384-855.258Zm1.538,0a3.259,3.259,0,0,0,3.077,3.407,3.259,3.259,0,0,0,3.077-3.407,3.258,3.258,0,0,0-3.077-3.406A3.258,3.258,0,0,0-3491.846-855.258Z" transform="translate(3497.231 860.204)" fill="#212135"/>
                    </svg>
                    <label>Occupation</label>
                </div>
                <span>{{ user.ocupation }}</span>
            </div>
            <div class="flx jc-sb br-16 info-row ai-c">
                <div class="flx gap-8">
                    <svg xmlns="http://www.w3.org/2000/svg" height="17" viewBox="0 0 20.101 19.821">
                        <path d="M-3280.074-712.862a22.722,22.722,0,0,1-4.877-3.317,11.435,11.435,0,0,1-3.8-6.158,8.244,8.244,0,0,1,1.584-6.6c1.235-1.576,3.682-3.454,8.318-3.454s7.083,1.878,8.319,3.454a8.245,8.245,0,0,1,1.584,6.6,11.436,11.436,0,0,1-3.8,6.158,22.725,22.725,0,0,1-4.878,3.317,2.694,2.694,0,0,1-1.222.3A2.7,2.7,0,0,1-3280.074-712.862Zm-5.778-15.036a6.543,6.543,0,0,0-1.258,5.237,9.809,9.809,0,0,0,3.287,5.243,21.039,21.039,0,0,0,4.511,3.065,1.013,1.013,0,0,0,.461.112,1.015,1.015,0,0,0,.462-.112,21.039,21.039,0,0,0,4.511-3.065,9.818,9.818,0,0,0,3.287-5.243,6.547,6.547,0,0,0-1.258-5.237c-1.443-1.84-3.864-2.813-7-2.813S-3284.41-729.739-3285.852-727.9Zm3.651,3.886a3.353,3.353,0,0,1,3.349-3.35,3.353,3.353,0,0,1,3.35,3.35,3.353,3.353,0,0,1-3.35,3.349A3.352,3.352,0,0,1-3282.2-724.012Zm1.675,0a1.676,1.676,0,0,0,1.674,1.675,1.676,1.676,0,0,0,1.675-1.675,1.677,1.677,0,0,0-1.675-1.675A1.676,1.676,0,0,0-3280.526-724.012Z" transform="translate(3288.902 732.387)" fill="#212135"/>
                    </svg>
                    <label>Address</label>
                </div>
                <span>{{ user.address || 'n/a' }}</span>
            </div>
            <div v-if="!is_parent" class="flx column ai-c gap-24">
                <h4>Registered kids</h4>
                <div class="stack-cards">
                    <profile-avatar v-for="kid in registered_kids.slice(0, 4)" :key="kid.id" :id="user.id" :image="kid.photo" />
                    <div v-if="registered_kids.length > 4" class="counter bg-img bg-white centered br-50">+{{ registered_kids.length - 4 }}</div>
                </div>
                <a @click.prevent="goToParentProfile" href="#" class="a-button a-btn button-primary btn-lg w-100">View more</a>
            </div>
        </div>
    </div>
</div>
</template>

<script>
import { postApi } from '@/api';
import { mapState } from 'vuex';
import usersLevelMixin from '@/mixins/usersLevelMixin';
import ProfileAvatar from '@/components/includes/app/ProfileAvatar.vue'
export default {
    components: { ProfileAvatar },
    name: 'MessageDetailParentView',
    props: ['to_id'],
    mixins: [usersLevelMixin],
    computed: {
        ...mapState({
            hostname: (state) => state.hostname,
            token: (state) => state.token
        }),
        computedAcct() {
            const user = this.user.access_level
            if(user == '0')
            return 'admin'
            else if(user == '1')
            return 'village'
            else
            return this.user.relationship
            
        }
    },
    data () {
        return {
            user: '',
            registered_kids: []
        }
    },
    methods: {
        async FetchThisUser() {
            try {
                const res = await postApi(this.hostname + '/api/fetch-this-user?token='+ this.token, {id: this.to_id})
                if(res.data) {
                    this.user = res.data.thisUser
                    this.registered_kids = res.data.kids
                }
            } catch (error) {
                console.error(error)
            }
        },
        goToParentProfile() {
            this.$router.push({ name: 'ViewParentProfile', params: { parent_id: this.user.id, parent: this.user.name } })
        }
    },
    mounted() {
        this.FetchThisUser()
    }
}
</script>

<style lang="scss" scoped>
.u-profile{
    width: 360px;
    // border-left: 1px solid #e3e5ef;
    padding-left: 20px;
    .bg-img {
        height: 120px;
        width: 120px;
    }

}
.profile-body{
    height: 100%;
    overflow-y: auto;
    padding: 16px 0 32px 0 ;
    overflow-y: auto;
    &::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none; 
        scrollbar-width: none; 
    }
}
.stack-cards{
    .bg-img {
        height: 60px;
        width: 60px;
        border: 2px solid #fff;
    }
}
.close-btn {
    position: absolute;
    height: 48px;
    width: 48px;
    padding: unset;
    right: 0;
    background-color: var(--bg-color);
    &:hover {
        background-color: var(--input-hover);
        path{
            fill: var(--ft-dark);
        }
    }
}
</style>